import testing ;
import os ;
local PREFIX = [ os.environ PREFIX ] ;

if $(PREFIX) = "" {
    PREFIX = "/usr/local" ;
}

alias libea :
    /boost//program_options
    /boost//serialization
    /boost//signals
    /boost//iostreams
    /boost//regex
    /boost//system
    /site-config//z
    : : : <include>./include
    ;

lib libea_runner :
    src/main.cpp
    src/cmdline_interface.cpp
    libea
    ;

run test/test_checkpoint.cpp
    test/test_metadata.cpp
    test/test_rng.cpp
    test/test_circular.cpp
    test/test_information.cpp
    test/test_analysis.cpp
    test/test.cpp
    src/cmdline_interface.cpp
    libea
    /boost//unit_test_framework
    ;

run test/test_lod.cpp
    test/test.cpp
    src/cmdline_interface.cpp
    libea
    /boost//unit_test_framework
    ;

run test/test_metapopulation.cpp
    test/test_qhfc.cpp
    test/test.cpp
    src/cmdline_interface.cpp
    libea
    /boost//unit_test_framework
    ;

run test/test_digital_evolution.cpp
    test/test_digital_evolution_types.cpp
    test/test.cpp
    src/cmdline_interface.cpp
    libea
    /boost//unit_test_framework
    ;

run test/test_deep_markov_network.cpp
    test/test_markov_network.cpp
    libea
    /boost//unit_test_framework
    ;

run test/test_neural_network.cpp
    libea
    /boost//unit_test_framework
    ;

alias install : install-lib install-headers ;

install install-lib :
    libea_runner
    : <location>$(PREFIX)/lib <install-type>LIB <install-dependencies>on
    ;

install install-headers :
    [ glob-tree *.h : test ]
    : <location>$(PREFIX)/include <install-source-root>include
    ;

explicit install install-lib install-headers ;
